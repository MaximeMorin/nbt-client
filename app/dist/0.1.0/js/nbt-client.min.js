"use strict";angular.module("nbt.main",[]),angular.module("nbt.authentication",[]),angular.module("nbt",["ngRoute","ngResource","ngSanitize","nbt.main","nbt.authentication"]),angular.module("nbt").config(["$routeProvider",function(a){a.otherwise({redirectTo:"/"})}]),angular.module("nbt.authentication").factory("authenticationCacheService",[function(){var a=this;return a.cache=function(a){try{localStorage.setItem("authentication",JSON.stringify(a))}catch(b){console.error("Failed to cache authentication data.")}},a.clear=function(){localStorage.removeItem("authentication")},a.getDisplayName=function(){var b=null;return a.isAuthenticated()&&(b=a._getData().displayName),b},a.getToken=function(){var b=null;if(a.isAuthenticated()){var c=a._getData();b={value:c.value,expiry:c.expiry,valid:c.valid}}return b},a.isAuthenticated=function(){return null!==a._getData()},a._getData=function(){var a=localStorage.getItem("authentication");return null!==a&&(a=JSON.parse(a)),a},a}]),angular.module("nbt.authentication").factory("authenticationFactory",["authenticationService","authenticationCacheService",function(a,b){var c=this;return c.authenticate=function(c,d){var e=a.authenticate({username:c,password:d}).$promise;return e.then(function(a){b.cache(a.data)},function(a){alert("Oh snap!")}),e},c.deauthenticate=function(){var d=a.deauthenticate({token:c.getToken().value}).$promise;return d.then(function(a){b.clear()},function(a){alert("Failed to deauthenticate")}),d},c.getDisplayName=function(){return b.getDisplayName()},c.isAuthenticated=function(){return b.isAuthenticated()},c.getToken=function(){return b.getToken()},c}]),angular.module("nbt.authentication").factory("authenticationInterceptor",["authenticationCacheService",function(a){var b=this;return b.request=function(b){if(b.headers=b.headers||{},a.isAuthenticated()){var c=a.getToken();c.valid&&(b.headers["X-NBT-Token"]=c.value)}return b},b.response=function(a){return 401===a.status,a},b}]),angular.module("nbt.authentication").config(["$httpProvider",function(a){a.interceptors.push("authenticationInterceptor")}]),angular.module("nbt.authentication").factory("authenticationService",["$resource",function(a){return a("http://api-dev.netbattletech.com/security/tokens/:token",{token:"@token"},{authenticate:{method:"POST",params:null,isArray:!1},deauthenticate:{method:"DELETE",params:null,isArray:!1}})}]),angular.module("nbt.authentication").controller("loginController",["authenticationFactory",function(a){var b=this;return b.visible=!1,b.data={username:"",password:""},b.isVisible=function(){return b.visible},b.show=function(){b.visible=!0},b.hide=function(){b.visible=!1},b.doLogin=function(){a.authenticate(b.data.username,b.data.password),b.hide()},b.doLogout=function(){a.deauthenticate()},b}]),angular.module("nbt.main").controller("mainController",["authenticationFactory",function(a){var b=this;return b.getDisplayName=function(){return a.getDisplayName()},b.isAuthenticated=function(){return a.isAuthenticated()},b}]);
//# sourceMappingURL=nbt-client.min.js.map